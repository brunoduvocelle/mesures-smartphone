<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Laboratoire de Mesure Hardware</title>
    <style>
        :root {
            --bg: #020617;
            --card: #0f172a;
            --accent: #0ea5e9;
            --text: #f8fafc;
            --dim: #64748b;
            --neon: #22d3ee;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Monaco', 'Consolas', monospace;
            margin: 0;
            padding: 15px;
            font-size: 13px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .instrument {
            background: var(--card);
            border: 1px solid #1e293b;
            padding: 10px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .instrument::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 2px; height: 100%;
            background: var(--accent);
        }
        .label { color: var(--dim); font-size: 10px; text-transform: uppercase; margin-bottom: 5px; }
        .val { color: var(--neon); font-size: 14px; font-weight: bold; min-height: 1.2em; }
        .unit { font-size: 10px; color: var(--dim); margin-left: 4px; }
        
        #btn-init {
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
        }
        .category-title {
            grid-column: 1 / -1;
            border-bottom: 1px solid #334155;
            padding: 10px 0 5px 0;
            color: var(--accent);
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2 style="text-align:center; color: var(--accent)">INSTRUMENTATION SYSTÈME RÉCURRENTE</h2>
    <button id="btn-init">DÉVERROUILLER TOUS LES INSTRUMENTS</button>

    <div class="grid" id="dashboard">
        </div>

<script>
{
    const db = {}; // Store des données
    const container = document.getElementById('dashboard');

    const sensorsMap = [
        { cat: "Environnement", id: "pres", name: "Baromètre", class: "PressureSensor", unit: "hPa" },
        { cat: "Environnement", id: "light", name: "Luminosité", class: "AmbientLightSensor", unit: "lux" },
        { cat: "Mouvement", id: "acc", name: "Accéléro", class: "Accelerometer", unit: "m/s²" },
        { cat: "Mouvement", id: "gyro", name: "Gyroscope", class: "Gyroscope", unit: "rad/s" },
        { cat: "Mouvement", id: "mag", name: "Magnéto", class: "Magnetometer", unit: "µT" },
        { cat: "Mouvement", id: "grav", name: "Gravité", class: "GravitySensor", unit: "m/s²" },
        { cat: "Réseau & Bio", id: "net", name: "Latence (RTT)", unit: "ms" },
        { cat: "Réseau & Bio", id: "down", name: "Bande Passante", unit: "Mbps" },
        { cat: "Système", id: "bat", name: "Batterie", unit: "%" },
        { cat: "Système", id: "temp", name: "Cœurs CPU", unit: "Logical" },
        { cat: "Toucher", id: "touch", name: "Force Pression", unit: "0-1" }
    ];

    const createInstruments = () => {
        let lastCat = "";
        sensorsMap.forEach(s => {
            if(s.cat !== lastCat) {
                const title = document.createElement('div');
                title.className = "category-title";
                title.innerText = s.cat;
                container.appendChild(title);
                lastCat = s.cat;
            }
            const div = document.createElement('div');
            div.className = "instrument";
            div.innerHTML = `
                <div class="label">${s.name}</div>
                <div class="val" id="v-${s.id}">--</div>
                <div class="unit">${s.unit || ''}</div>
            `;
            container.appendChild(div);
        });
    };

    const updateUI = () => {
        for (const [id, value] of Object.entries(db)) {
            const el = document.getElementById(`v-${id}`);
            if (el) el.innerText = value;
        }
        requestAnimationFrame(updateUI);
    };

    const initInstruments = async () => {
        // 1. Capteurs API Générique (Finesse : Fréquence 60Hz)
        sensorsMap.filter(s => s.class).forEach(s => {
            if (s.class in window) {
                try {
                    const sensor = new window[s.class]({ frequency: 60 });
                    sensor.onreading = () => {
                        if (s.id === 'pres') db[s.id] = sensor.pressure.toFixed(2);
                        else if (s.id === 'light') db[s.id] = sensor.illuminance.toFixed(1);
                        else db[s.id] = `${sensor.x?.toFixed(1)}, ${sensor.y?.toFixed(1)}, ${sensor.z?.toFixed(1)}`;
                    };
                    sensor.start();
                } catch(e) { db[s.id] = "Bloqué"; }
            } else { db[s.id] = "N/A"; }
        });

        // 2. Instrument Réseau (Network Information API)
        if (navigator.connection) {
            const updateNet = () => {
                db['net'] = navigator.connection.rtt;
                db['down'] = navigator.connection.downlink;
            };
            navigator.connection.onchange = updateNet;
            updateNet();
        }

        // 3. Instrument Batterie
        if (navigator.getBattery) {
            const bat = await navigator.getBattery();
            const upBat = () => db['bat'] = (bat.level * 100).toFixed(0);
            bat.onlevelchange = upBat;
            upBat();
        }

        // 4. Instrumentation CPU
        db['temp'] = navigator.hardwareConcurrency || "Inconnu";

        // 5. Instrument Toucher (Pression et surface)
        window.addEventListener('touchmove', (e) => {
            const t = e.touches[0];
            db['touch'] = `F:${(t.force || 0).toFixed(2)} | R:${(t.radiusX || 0).toFixed(1)}`;
        }, {passive: true});

        updateUI();
    };

    document.getElementById('btn-init').onclick = () => {
        document.getElementById('btn-init').style.display = 'none';
        createInstruments();
        initInstruments();
    };
}
</script>
</body>
</html>
